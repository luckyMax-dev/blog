# Binlog 增量订阅 2：基本数据类型表示

MySQL 使用两种基本数据类型来表示字节组成结构，分别是：

- Integer Types，表示不同大小的整数；
- String Types，表示字符串；

两种基本类型组成了不同类型的协议包，例如用来表示一个协议包大小，协议包中某个 string 字段；这两种类型下还有几种不同的表示。

### Integer Types

整数类型分为两种表示，分别是固定长度与可变长度。

#### int\<n>

表示如下，字节顺序使用 Little Endian：

| 表示   | 说明                  | 举例字节数组与 10 进制表示                            |
| ------ | --------------------- | ----------------------------------------------------- |
| int<1> | 使用 1 个字节表示整数 | 0x1（1）                                              |
| int<2> | 使用 2 个字节表示整数 | 0x0 0x1（256）                                        |
| int<3> | 使用 3 个字节表示整数 | 0x0 0x0 0x1（655360）                                 |
| int<4> | 使用 4 个字节表示整数 | 0x0 0x1 0x1 0x1（168430080）                          |
| int<6> | 使用 6 个字节表示整数 | 0x1 0x2 0x3 0x4 0x5 0x6（6618611909121）              |
| int<8> | 使用 8 个字节表示整数 | 0x0 0x1 0x2 0x3 0x4 0x5 0x6 0x7（506097522914230528） |

#### int\<lenenc>

可变长度分别占用 1，3，4，9 个字节表示，一个值的大小表示规则如下：

- 如果值 < 251，则使用 1 个字节表示，例如值  245（0xf5）；
- 如果值 >= 251 && < Math.pow(2, 16)，则使用 1 个字节前缀 fc + 2 个字节表示，例如值 258（0xfc 0x2 0x1）；
- 如果值 >= Math.pow(2, 16) && < Math.pow(2, 24)，则使用 1 个字节前缀 fd + 3 个字节表示，例如值 131072（0xfd 0x0 0x0 0x2）；
- 如果值 >= Math.pow(2, 24) && < Math.pow(2, 64)，则使用 1 个字节前缀 fe + 8 个字节表示；

反过来，如果要从字节数组中读取值的大小，检查数组中的第 1 个字节，规则如下：

- 如果第 1 个字节 < 0xfb，则该字节本身就代表值的大小，例如 fa（250）；
- 如果第 1 个字节 == 0xfc，则后续的 2 个字节代表值的大小，例如 0xfc 0xfb 0x00（251） ；
- 如果第 1 个字节 == 0xfd，则后续的 3 个字节代表值的大小；
- 如果第 1 个字节 == 0xfe，则后续的 8 个字节代表值的大小；

### String Types

字符串类型有 5 种表示。

#### stirng\<fix>

表示固定长度的字符串。

#### stirng\<NUL>

表示以 [00] 字节作为截断。

#### stirng\<var>

待补充。

#### stirng\<lenenc>

可变长字符串，由两部分组成：

1. length：字符串长度，使用 int\<lenenc> 表示；
2. stirng：字符串本身，使用 stirng\<fix> 表示；

#### string\<EOF>

待补充。

以上是 MySQL 两种基本数据类型 int 和字符串的表示，在从 binlog 字节流中读取 int 类型时，需要按照 LSB 的顺序读取字节。

### 参考文档

MySQL 基本数据类型：https://dev.mysql.com/doc/internals/en/basic-types.html
